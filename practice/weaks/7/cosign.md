–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π —Ä–∞–∑–ª–æ–∂–∏–º **Cosign**, **Sigstore**, –∏ **SLSA (Supply Chain Levels for Software Artifacts)** –ø–æ —à–∞–≥–∞–º, –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π DevSecOps –∏–Ω–∂–µ–Ω–µ—Ä, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–ª—è:

* –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π –Ω–∞ —ç—Ç–∞–ø–µ **CI/CD**, **–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ** –∏ **–Ω–∞ —É—Ä–æ–≤–Ω–µ Kubernetes-–¥–µ–ø–ª–æ—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Helm Chart)**;
* –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≤ **GitLab CI/CD**;
* –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –æ–±—Ä–∞–∑ –±—ã–ª —Å–æ–∑–¥–∞–Ω **–∞—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–º pipeline**, –∞ –Ω–µ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–º.

---

## üß© –ß—Ç–æ —Ç–∞–∫–æ–µ Cosign, Sigstore –∏ SLSA

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                       |
| ------------ | ---------------------------------------------------------------- |
| **Cosign**   | –ü–æ–¥–ø–∏—Å—å –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤          |
| **Sigstore** | –û–±—â–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –≤–æ–∫—Ä—É–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–µ–π |
| **SLSA**     | –£—Ä–æ–≤–Ω–µ–≤–∞—è –º–æ–¥–µ–ª—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ Supply Chain                         |

---

## üì¶ Cosign –≤ –¥–µ—Ç–∞–ª—è—Ö

### üîê –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Cosign?

* –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—Ä–∞–∑—ã: `docker.io/myapp:1.0`
* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤ **OCI-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º** —Ä–µ–µ—Å—Ç—Ä–µ (–≤–º–µ—Å—Ç–µ —Å –æ–±—Ä–∞–∑–æ–º)
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É (–∏–ª–∏ –∫–ª—é—á–∞–º –≤ Fulcio/Keyless)

---

## üîß –ö–∞–∫ –ø–æ–¥–ø–∏—Å–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–∑

### –ü–æ–¥–ø–∏—Å—å (–≤ CI)

```bash
cosign sign --key cosign.key docker.io/myapp:1.0
```

–°–æ–∑–¥–∞—Å—Ç:

* `docker.io/myapp:1.0` ‚Äî –æ–±—Ä–∞–∑
* `docker.io/myapp:1.0.sig` ‚Äî –ø–æ–¥–ø–∏—Å—å
* `docker.io/myapp:1.0.att` ‚Äî (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥ pull/deploy):

```bash
cosign verify \
  --key cosign.pub \
  docker.io/myapp:1.0
```

---

## üîç –ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞?

| –°—Ç–∞–¥–∏—è     | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏                           | –ù—É–∂–Ω–æ –ª–∏ –∏–º–µ—Ç—å –∫–ª—é—á?          |
| ---------- | ------------------------------------------ | ----------------------------- |
| –í CI       | ‚úÖ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ deploy-–¥–∂–æ–±–µ)               | –î–∞, –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á            |
| –í registry | ‚ùå (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è)            | –ù–µ —É–º–µ—é—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–∞–º–∏       |
| –ù–∞ –¥–µ–ø–ª–æ–µ  | ‚úÖ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Kyverno/OPA/Gatekeeper) | –î–∞, –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–≤ policy) |

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ Helm Chart / Kubernetes

–î–æ–ø—É—Å—Ç–∏–º —É –Ω–∞—Å Helm Chart, –∏ –º—ã —Ö–æ—Ç–∏–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–±—Ä–∞–∑:

* –ü–æ–¥–ø–∏—Å–∞–Ω Cosign
* –ü–æ–¥–ø–∏—Å–∞–Ω **—Ç–æ–ª—å–∫–æ –Ω–∞—à–∏–º CI**

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cosign —Å –∫–ª—é—á–∞–º–∏

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–ª—é—á:

```bash
cosign generate-key-pair
```

–°–æ—Ö—Ä–∞–Ω–∏ `cosign.pub` –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, ConfigMap –≤ k8s:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: cosign-public-key
  namespace: security
data:
  cosign.pub: |
    -----BEGIN PUBLIC KEY-----
    ...
```

---

### 2. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏ Kyverno: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

```yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: verify-image-signature
spec:
  validationFailureAction: enforce
  background: false
  rules:
    - name: require-signed-images
      match:
        any:
          - resources:
              kinds: ["Pod"]
      verifyImages:
        - image: "docker.io/myorg/*"
          key: |
            -----BEGIN PUBLIC KEY-----
            ...
          attestations:
            - name: slsa-attestation
              predicateType: https://slsa.dev/provenance/v0.2
              conditions:
                - all:
                    - key: "{{ .builder.id }}"
                      operator: Equals
                      value: "https://gitlab.com/mygroup/myproject/.gitlab-ci.yml@refs/heads/main"
```

–≠—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∞:

* –¢—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –æ–±—Ä–∞–∑ –∏–∑ `docker.io/myorg/` –±—ã–ª –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞—à–∏–º –∫–ª—é—á–æ–º
* –¢—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã SLSA provenance (`.att`) —Å–æ–¥–µ—Ä–∂–∞–ª CI source

---

## üîÅ –ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞—Ç—å —Å SLSA –∏ attestations?

### –ß—Ç–æ —Ç–∞–∫–æ–µ attestation?

–≠—Ç–æ JSON-–¥–æ–∫—É–º–µ–Ω—Ç, –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º—ã–π –∫ –æ–±—Ä–∞–∑—É, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π **–∫–∞–∫, –≥–¥–µ –∏ –∫–µ–º** –æ–Ω –±—ã–ª —Å–æ–±—Ä–∞–Ω.

–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:

```bash
cosign attest --predicate slsa-provenance.json --key cosign.key docker.io/myapp:1.0
```

–ü—Ä–∏–º–µ—Ä `slsa-provenance.json`:

```json
{
  "builder": {
    "id": "https://gitlab.com/myorg/project/.gitlab-ci.yml@refs/heads/main"
  },
  "buildType": "https://gitlab.com/gitlab-ci",
  "invocation": {
    "configSource": {
      "uri": "git+https://gitlab.com/myorg/project",
      "digest": {
        "sha1": "..."
      }
    }
  }
}
```

---

## üõ†Ô∏è –ö–∞–∫ —ç—Ç–æ –≤—Å—ë –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ GitLab CI/CD

### 1. –®–∞–≥ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –≤ `.gitlab-ci.yml`

```yaml
stages:
  - build
  - sign
  - deploy

variables:
  COSIGN_PASSWORD: "${COSIGN_PASSWORD}"  # secret

build-image:
  stage: build
  image: docker:20.10
  script:
    - docker build -t docker.io/myorg/app:$CI_COMMIT_SHA .
    - docker push docker.io/myorg/app:$CI_COMMIT_SHA

sign-image:
  stage: sign
  image: cgr.dev/chainguard/cosign
  script:
    - cosign sign --key cosign.key docker.io/myorg/app:$CI_COMMIT_SHA
    - cosign attest --predicate slsa.json --key cosign.key docker.io/myorg/app:$CI_COMMIT_SHA
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes Policy Engine

–ù–∞ –ø—Ä–æ–¥–µ —Ç—ã **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—à—å** —á–µ—Ä–µ–∑ Kyverno –∏–ª–∏ OPA, —á—Ç–æ:

* –û–±—Ä–∞–∑ –ø–æ–¥–ø–∏—Å–∞–Ω
* –ü–æ–¥–ø–∏—Å–∞–Ω –∏–º–µ–Ω–Ω–æ —Ç–≤–æ–∏–º CI
* –û–±—Ä–∞–∑ –Ω–µ –º—É—Ç–∏—Ä–æ–≤–∞–ª

---

## üìà –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

| –ë–µ–∑ –ø–æ–¥–ø–∏—Å–∏                 | –° –ø–æ–¥–ø–∏—Å—è–º–∏ (Cosign + SLSA)              |
| --------------------------- | ---------------------------------------- |
| –ù–µ—Ç –¥–æ–≤–µ—Ä–∏—è –∫ –æ–±—Ä–∞–∑—É        | –ü–æ–¥–ø–∏—Å—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å          |
| –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞–∑ | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–µ–ø–ª–æ–π —Ñ–∞–ª—å—à–∏    |
| –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Å–±–æ—Ä–∫–∏          | –ï—Å—Ç—å attestation –∏ —Ü–µ–ø–æ—á–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è |

---

## üîê Vault/SOPS –∏ —Å–µ–∫—Ä–µ—Ç—ã

–¢—ã –º–æ–∂–µ—à—å **–≤—Å—ë —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å**, —à–∏—Ñ—Ä—É—è:

* –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á `cosign.key` —á–µ—Ä–µ–∑ SOPS –∏ KMS (–∏–ª–∏ Vault)
* –¥–æ–±–∞–≤–ª—è—è —ç—Ç–∞–ø—ã –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏ –≤ CI —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞

---

## üìã –í—ã–≤–æ–¥

–ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç       | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                      | –ì–¥–µ –≤–Ω–µ–¥—Ä—è—Ç—å                            |
| --------------- | ----------------------------------------------- | --------------------------------------- |
| **Cosign**      | –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—Ä–∞–∑—ã                  | CI, Deploy, Policy                      |
| **Sigstore**    | –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç keyless-–ø–æ–¥–ø–∏—Å–∏, –ø—É–±–ª–∏—á–Ω—ã–µ –∂—É—Ä–Ω–∞–ª—ã | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —Ä—É—á–Ω–æ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–ª—é—á–∞–º–∏ |
| **SLSA**        | –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—É–¥–∏—Ç –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è                | CI ‚Üí Attestation ‚Üí Kubernetes           |
| **Kyverno/OPA** | –í–Ω–µ–¥—Ä—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏                      | –í admission webhook (–∫–ª–∞—Å—Ç–µ—Ä)           |

